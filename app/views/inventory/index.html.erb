<!DOCTYPE html>
<html>
  <head>
    <title>Inventory - Hotel Management System</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
      body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
      .container { max-width: 1400px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
      .header { text-align: center; color: #333; margin-bottom: 30px; }
      .nav-link { display: inline-block; margin: 10px; padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 5px; }
      .nav-link:hover { background: #2980b9; }
      .alerts-section { margin-bottom: 30px; }
      .alert-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 20px; }
      .alert-card { padding: 15px; border-radius: 8px; color: white; }
      .alert-low-stock { background: #e74c3c; }
      .alert-expiring { background: #f39c12; }
      .inventory-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
      .inventory-table th, .inventory-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
      .inventory-table th { background: #3498db; color: white; }
      .inventory-table tr:hover { background: #f5f5f5; }
      .status-good { color: #27ae60; font-weight: bold; }
      .status-low-stock { color: #e74c3c; font-weight: bold; }
      .status-expiring-soon { color: #f39c12; font-weight: bold; }
      .status-expired { color: #c0392b; font-weight: bold; }
      .category-filter { margin-bottom: 20px; }
      .filter-btn { padding: 8px 15px; margin: 5px; background: #ecf0f1; border: 1px solid #bdc3c7; border-radius: 5px; cursor: pointer; }
      .filter-btn.active { background: #3498db; color: white; }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h1>üì¶ Inventory Management</h1>
        <div>
          <%= link_to "Home", root_path, class: "nav-link" %>
          <%= link_to "Dashboard", dashboard_path, class: "nav-link" %>
          <%= link_to "Menu", menu_index_path, class: "nav-link" %>
          <%= link_to "Orders", orders_path, class: "nav-link" %>
          <%= link_to "Inventory", inventory_index_path, class: "nav-link" %>
          <%= link_to "üö® Alerts", alerts_inventory_index_path, class: "nav-link", style: "background: #e74c3c;" %>
        </div>
      </div>

      <!-- Alerts Section -->
      <% if @low_stock_items.any? || @expiring_items.any? %>
        <div class="alerts-section">
          <h2 style="color: #e74c3c; margin-bottom: 15px;">üö® Inventory Alerts</h2>
          <div class="alert-grid">
            <% if @low_stock_items.any? %>
              <div class="alert-card alert-low-stock">
                <h3>‚ö†Ô∏è Low Stock Items</h3>
                <div style="font-size: 2em; font-weight: bold;"><%= @low_stock_items.count %></div>
                <p>Items below minimum quantity</p>
              </div>
            <% end %>
            
            <% if @expiring_items.any? %>
              <div class="alert-card alert-expiring">
                <h3>‚è∞ Expiring Soon</h3>
                <div style="font-size: 2em; font-weight: bold;"><%= @expiring_items.count %></div>
                <p>Items expiring within 3 days</p>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Category Filter -->
      <div class="category-filter">
        <h3>Filter by Category:</h3>
        <button class="filter-btn active" onclick="filterByCategory('all')">All</button>
        <% @categories.each do |category| %>
          <button class="filter-btn" onclick="filterByCategory('<%= category %>')"><%= category.humanize %></button>
        <% end %>
      </div>

      <!-- Inventory Table -->
      <table class="inventory-table">
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Category</th>
            <th>Quantity</th>
            <th>Unit</th>
            <th>Status</th>
            <th>Expiry Date</th>
            <th>Cost per Unit</th>
            <th>Supplier</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @inventory_items.each do |item| %>
            <tr data-category="<%= item.category %>">
              <td><strong><%= item.name %></strong></td>
              <td><%= item.category.humanize %></td>
              <td>
                <%= item.quantity %>
                <% if item.minimum_quantity %>
                  <small style="color: #666;">(min: <%= item.minimum_quantity %>)</small>
                <% end %>
              </td>
              <td><%= item.unit %></td>
              <td>
                <span class="status-<%= item.status.gsub(' ', '-') %>">
                  <%= item.status.humanize %>
                </span>
              </td>
              <td>
                <% if item.expiry_date %>
                  <%= item.expiry_date.strftime('%b %d, %Y') %>
                  <% if item.expiring_soon? %>
                    <small style="color: #f39c12;">(Soon!)</small>
                  <% elsif item.expired? %>
                    <small style="color: #e74c3c;">(Expired!)</small>
                  <% end %>
                <% else %>
                  <span style="color: #95a5a6;">No expiry</span>
                <% end %>
              </td>
              <td>
                <% if item.cost_per_unit %>
                  $<%= item.cost_per_unit %>
                <% else %>
                  <span style="color: #95a5a6;">-</span>
                <% end %>
              </td>
              <td>
                <%= item.supplier || '-' %>
              </td>
              <td>
                <%= link_to "View", inventory_path(item), style: "color: #3498db; text-decoration: none; margin-right: 10px;" %>
                <%= link_to "Edit", edit_inventory_path(item), style: "color: #f39c12; text-decoration: none;" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      <div style="margin-top: 30px; text-align: center;">
        <%= link_to "‚ûï Add New Item", new_inventory_path, class: "nav-link", style: "background: #27ae60;" %>
      </div>
    </div>

    <script>
      function filterByCategory(category) {
        const rows = document.querySelectorAll('[data-category]');
        const buttons = document.querySelectorAll('.filter-btn');
        
        // Update button states
        buttons.forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        // Filter rows
        rows.forEach(row => {
          if (category === 'all' || row.dataset.category === category) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        });
      }
    </script>
  </body>
</html>